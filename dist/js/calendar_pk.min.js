!function(){"use strict";angular.module("directives",[]),angular.module("constants",[]),angular.module("filters",[]);angular.module("calendar_pk",["directives","constants","templates","filters"])}(),function(){"use strict";angular.module("constants").constant("calendarConfig",{formatDay:"dd",formatDayHeader:"EEE",formatMonthTitle:"MMMM yyyy",eventSource:null,queryMode:"local",step:30,startingDayMonth:1})}(),function(){"use strict";function calendar(){function calendarLink(scope,element,attrs,ctrls){var calendarCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&calendarCtrl.init(ngModelCtrl)}function CalendarController($scope,$attrs,$parse,$interpolate,calendarConfig,$timeout,$ionicSlideBoxDelegate,dateFilter){function getAdjacentCalendarDate(currentCalendarDate,direction){var firstDayInNextMonth,step=vm.mode.step,calculateCalendarDate=new Date(currentCalendarDate),year=calculateCalendarDate.getFullYear()+direction*(step.years||0),month=calculateCalendarDate.getMonth()+direction*(step.months||0),date=calculateCalendarDate.getDate()+direction*(step.days||0);return calculateCalendarDate.setFullYear(year,month,date),firstDayInNextMonth=new Date(year,month+1,1),firstDayInNextMonth.getTime()<=calculateCalendarDate.getTime()&&(calculateCalendarDate=new Date(firstDayInNextMonth-864e5)),calculateCalendarDate}function getViewData(startTime){function getDates(startDate,n){var dates=new Array(n),current=new Date(startDate),i=0;for(current.setHours(12);n>i;)dates[i++]=new Date(current),current.setDate(current.getDate()+1);return dates}function createDateObject(date,format){return{date:date,label:dateFilter(date,format)}}for(var startDate=startTime,date=startDate.getDate(),month=(startDate.getMonth()+(1!==date?1:0))%12,days=getDates(startDate,42),i=0;42>i;i++)days[i]=angular.extend(createDateObject(days[i],vm.formatDay),{secondary:days[i].getMonth()!==month});return{dates:days}}function getRange(currentDate){var endDate,year=currentDate.getFullYear(),month=currentDate.getMonth(),firstDayOfMonth=new Date(year,month,1),difference=vm.startingDayMonth-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,startDate=new Date(firstDayOfMonth);return numDisplayedFromPreviousMonth>0&&startDate.setDate(-numDisplayedFromPreviousMonth+1),endDate=new Date(startDate),endDate.setDate(endDate.getDate()+42),{startTime:startDate,endTime:endDate}}function onDataLoaded(){for(var eventSource=vm.eventSource,len=eventSource?eventSource.length:0,startTime=vm.range.startTime,endTime=vm.range.endTime,timeZoneOffset=-(new Date).getTimezoneOffset(),utcStartTime=new Date(startTime.getTime()+60*timeZoneOffset*1e3),utcEndTime=new Date(endTime.getTime()+60*timeZoneOffset*1e3),currentViewIndex=scope.currentViewIndex,dates=scope.views[currentViewIndex].dates,oneDay=864e5,eps=.001,r=0;42>r;r+=1)dates[r].hasEvent&&(dates[r].hasEvent=!1,dates[r].events=[]);for(var i=0;len>i;i+=1){var st,et,event=eventSource[i],eventStartTime=new Date(event.startTime),eventEndTime=new Date(event.endTime);if(event.allDay){if(utcStartTime>=eventEndTime||eventStartTime>=utcEndTime)continue;st=utcStartTime,et=utcEndTime}else{if(startTime>=eventEndTime||eventStartTime>=endTime)continue;st=startTime,et=endTime}var timeDifferenceStart;timeDifferenceStart=st>=eventStartTime?0:(eventStartTime-st)/oneDay;var timeDifferenceEnd;timeDifferenceEnd=eventEndTime>=et?(et-st)/oneDay:(eventEndTime-st)/oneDay;for(var eventSet,index=Math.floor(timeDifferenceStart);timeDifferenceEnd-eps>index;)dates[index].hasEvent=!0,eventSet=dates[index].events,eventSet?eventSet.push(event):(eventSet=[],eventSet.push(event),dates[index].events=eventSet),index+=1}for(r=0;42>r;r+=1)dates[r].hasEvent&&dates[r].events.sort(compareEvent);var findSelected=!1;for(r=0;42>r;r+=1){if(dates[r].selected){scope.selectedDate=dates[r],findSelected=!0;break}if(findSelected)break}}var vm=this;console.log("$attrs",$attrs);var ngModelCtrl={$setViewValue:angular.noop};angular.forEach(["formatDay","formatDayHeader","formatMonthTitle","eventSource","queryMode","step","startingDayMonth"],function(key,index){vm[key]=angular.isDefined($attrs[key])?$interpolate($attrs[key])($scope.$parent):calendarConfig[key]}),vm.hourParts=Math.floor(60/vm.step),$scope.$parent.$watch($attrs.eventSource,function(value){vm.onEventSourceChanged(value)}),angular.isDefined($attrs.initDate)&&(vm.currentCalendarDate=$scope.$parent.$eval($attrs.initDate)),vm.currentCalendarDate||(vm.currentCalendarDate=new Date,$attrs.ngModel&&!$scope.$parent.$eval($attrs.ngModel)&&$parse($attrs.ngModel).assign($scope.$parent,vm.currentCalendarDate)),vm.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=function(){vm.render()}},vm.render=function(){if(ngModelCtrl.$modelValue){var date=new Date(ngModelCtrl.$modelValue),isValid=!isNaN(date);isValid?this.currentCalendarDate=date:console.log('"ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),ngModelCtrl.$setValidity("date",isValid)}this.refreshView()},vm.refreshView=function(){this.mode&&(this.range=getRange(this.currentCalendarDate),$scope.titleChanged&&$scope.titleChanged({title:vm.getTitle()}),this._refreshView(),this.rangeChanged())},vm.onEventSourceChanged=function(value){vm.eventSource=value,onDataLoaded&&onDataLoaded()},vm.getAdjacentViewStartTime=function(direction){var adjacentCalendarDate=getAdjacentCalendarDate(vm.currentCalendarDate,direction);return getRange(adjacentCalendarDate).startTime},vm.move=function(direction){vm.direction=direction,vm.currentCalendarDate=getAdjacentCalendarDate(vm.currentCalendarDate,direction),ngModelCtrl.$setViewValue(vm.currentCalendarDate),vm.refreshView(),vm.direction=0},vm.rangeChanged=function(){"local"===vm.queryMode?vm.eventSource&&onDataLoaded&&onDataLoaded():"remote"===vm.queryMode&&$scope.rangeChanged&&$scope.rangeChanged({startTime:this.range.startTime,endTime:this.range.endTime})},vm.registerSlideChanged=function(scope){scope.currentViewIndex=0,scope.slideChanged=function($index){$timeout(function(){var currentViewIndex=scope.currentViewIndex,direction=0;console.log("currentViewIndex",currentViewIndex),console.log("$index",$index),currentViewIndex===$index-1||0===$index&&2===currentViewIndex?direction=1:(currentViewIndex===$index+1||2===$index&&0===currentViewIndex)&&(direction=-1),scope.currentViewIndex=$index,vm.move(direction),scope.$digest()},100)}},vm.populateAdjacentViews=function(scope){var currentViewStartDate,currentViewData,toUpdateViewIndex,currentViewIndex=scope.currentViewIndex;1===vm.direction?(currentViewStartDate=vm.getAdjacentViewStartTime(1),toUpdateViewIndex=(currentViewIndex+1)%3,angular.copy(getViewData(currentViewStartDate),scope.views[toUpdateViewIndex])):-1===vm.direction?(currentViewStartDate=vm.getAdjacentViewStartTime(-1),toUpdateViewIndex=(currentViewIndex+2)%3,angular.copy(getViewData(currentViewStartDate),scope.views[toUpdateViewIndex])):scope.views?(currentViewStartDate=vm.range.startTime,angular.copy(getViewData(currentViewStartDate),scope.views[currentViewIndex]),currentViewStartDate=vm.getAdjacentViewStartTime(-1),toUpdateViewIndex=(currentViewIndex+2)%3,angular.copy(getViewData(currentViewStartDate),scope.views[toUpdateViewIndex]),currentViewStartDate=vm.getAdjacentViewStartTime(1),toUpdateViewIndex=(currentViewIndex+1)%3,angular.copy(getViewData(currentViewStartDate),scope.views[toUpdateViewIndex])):(currentViewData=[],currentViewStartDate=vm.range.startTime,currentViewData.push(getViewData(currentViewStartDate)),currentViewStartDate=vm.getAdjacentViewStartTime(1),currentViewData.push(getViewData(currentViewStartDate)),currentViewStartDate=vm.getAdjacentViewStartTime(-1),currentViewData.push(getViewData(currentViewStartDate)),scope.views=currentViewData)},vm.getTitle=function(){var currentViewStartDate=vm.range.startTime,date=currentViewStartDate.getDate(),month=(currentViewStartDate.getMonth()+(1!==date?1:0))%12,year=currentViewStartDate.getFullYear()+(1!==date&&0===month?1:0),headerDate=new Date(year,month,1);return dateFilter(headerDate,vm.formatMonthTitle)}}var directive={};return directive.restrict="E",directive.replace=!0,directive.templateUrl="calendar.html",directive.scope={rangeChanged:"&",eventSelected:"&",timeSelected:"&",titleChanged:"&"},directive.require=["calendar","?^ngModel"],directive.link=calendarLink,calendarLink.$inject=[],directive.controller=CalendarController,CalendarController.$inject=["$scope","$attrs","$parse","$interpolate","calendarConfig","$timeout","$ionicSlideBoxDelegate","dateFilter"],directive}angular.module("directives").directive("calendar",calendar),calendar.$inject=[]}(),function(){"use strict";function monthView(){function monthViewLink(scope,element,attrs,ctrls){function updateCurrentView(currentViewStartDate,view){for(var currentCalendarDate=ctrl.currentCalendarDate,today=new Date,oneDay=864e5,selectedDayDifference=Math.floor((currentCalendarDate.getTime()-currentViewStartDate.getTime())/oneDay),currentDayDifference=Math.floor((today.getTime()-currentViewStartDate.getTime())/oneDay),r=0;42>r;r+=1)view.dates[r].selected=!1;selectedDayDifference>=0&&42>selectedDayDifference?(view.dates[selectedDayDifference].selected=!0,scope.selectedDate=view.dates[selectedDayDifference]):scope.selectedDate={events:[]},currentDayDifference>=0&&42>currentDayDifference&&(view.dates[currentDayDifference].current=!0)}var ctrl=ctrls[0];ctrls[1];scope.formatDayHeader=ctrl.formatDayHeader,ctrl.mode={step:{months:1}},scope.select=function(selectedDate){var dates,r,views=scope.views;if(views){dates=views[scope.currentViewIndex].dates;ctrl.currentCalendarDate;ctrl.currentCalendarDate=selectedDate;var currentViewStartDate=ctrl.range.startTime,oneDay=864e5,selectedDayDifference=Math.floor((selectedDate.getTime()-currentViewStartDate.getTime())/oneDay);for(r=0;42>r;r+=1)dates[r].selected=!1;selectedDayDifference>=0&&42>selectedDayDifference&&(dates[selectedDayDifference].selected=!0,scope.selectedDate=dates[selectedDayDifference]),scope.timeSelected&&scope.timeSelected({selectedTime:selectedDate})}},scope.getHighlightClass=function(date){var className="";return date.hasEvent&&(className=date.secondary?"monthview-secondary":"monthview-primary",className+=" "),date.selected&&(className+="monthview-selected",className+=" "),date.current&&(className+="monthview-current",className+=" "),date.secondary&&(className+="text-muted",className+=" "),className=className.slice(0,-1)},ctrl._refreshView=function(){ctrl.populateAdjacentViews(scope),updateCurrentView(ctrl.range.startTime,scope.views[scope.currentViewIndex])},ctrl.registerSlideChanged(scope),ctrl.refreshView()}var directive={};return directive.restrict="E",directive.replace=!0,directive.templateUrl="month-view.html",directive.require=["^calendar","?^ngModel"],directive.link=monthViewLink,monthViewLink.$inject=[],directive}angular.module("directives").directive("monthView",monthView),monthView.$inject=[]}(),function(){function weekNumber(){return function(date){date=new Date(+date),date.setHours(0,0,0,0),date.setDate(date.getDate()+3-(date.getDay()+6)%7);var week1=new Date(date.getFullYear(),0,4);return 1+Math.round(((date.getTime()-week1.getTime())/864e5-3+(week1.getDay()+6)%7)/7)}}angular.module("filters").filter("weekNumber",weekNumber),weekNumber.$inject=[]}(),function(){"use strict";angular.module("templates",[]).run(["$templateCache",function($templateCache){$templateCache.put("calendar.html",'<div style="height: 100%;">\n  <month-view></month-view>\n</div>\n'),$templateCache.put("month-view.html",'<div>\n    <ion-slide-box  on-slide-changed="slideChanged($index)"\n                    does-continue="true"\n                    show-pager="false"\n                    delegate-handle="monthview-slide"\n                    style="height: auto;">\n        <ion-slide ng-repeat="view in views track by $index">\n            <table ng-if="$index===currentViewIndex" class="table-bordered monthview-datetable">\n                <thead>\n                    <tr>\n                        <th></th>\n                        <th ng-repeat="day in view.dates.slice(0,7) track by day.date">\n                            <small>{{::day.date | date: formatDayHeader | uppercase}}</small>\n                        </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr ng-repeat="i in [0,1,2,3,4,5]">\n                        <td>SEM<br>{{view.dates[7*i].date | weekNumber}}</td>\n                        <td ng-repeat="j in [0,1,2,3,4,5,6]"\n                            ng-click="select(view.dates[7*i+j].date)"\n                            ng-class="getHighlightClass(view.dates[7*i+j])">{{view.dates[7*i+j].label}}</td>\n                    </tr>\n                </tbody>\n            </table>\n            <table ng-if="$index!==currentViewIndex" class="table-bordered monthview-datetable">\n                <thead>\n                    <tr class="text-center">\n                        <th></th>\n                        <th ng-repeat="day in view.dates.slice(0,7) track by day.date">\n                            <small>{{::day.date | date: formatDayHeader | uppercase}}</small>\n                        </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr ng-repeat="i in [0,1,2,3,4,5]">\n                        <td>SEM<br>{{view.dates[7*i].date | weekNumber}}</td>\n                        <td ng-repeat="j in [0,1,2,3,4,5,6]">{{view.dates[7*i+j].label}}</td>\n                    </tr>\n                </tbody>\n            </table>\n        </ion-slide>\n    </ion-slide-box>\n</div>\n')}])}();