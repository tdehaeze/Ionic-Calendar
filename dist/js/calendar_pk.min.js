!function(){"use strict";angular.module("directives",[]),angular.module("constants",[]),angular.module("filters",[]);angular.module("calendar_pk",["directives","constants","templates","filters"])}(),function(){"use strict";angular.module("constants").constant("calendarConfig",{formatDay:"dd",formatDayHeader:"EEE",formatMonthTitle:"MMMM yyyy",eventSource:null,queryMode:"local",startingDayMonth:1})}(),function(){"use strict";function calendar(){function CalendarController($scope,$attrs,$interpolate,calendarConfig,$timeout,dateFilter){function init(){angular.forEach(["formatDay","formatDayHeader","formatMonthTitle","queryMode","startingDayMonth"],function(key,index){vm[key]=angular.isDefined($attrs[key])?$interpolate($attrs[key])($scope.$parent):calendarConfig[key]}),vm.currentDate=new Date}function onDataLoaded(){for(var eventSource=$scope.eventSource,timeZoneOffset=-(new Date).getTimezoneOffset(),utcStartTime=new Date(vm.range.startTime.getTime()+60*timeZoneOffset*1e3),utcEndTime=new Date(vm.range.endTime.getTime()+60*timeZoneOffset*1e3),dates=$scope.views[$scope.currentViewIndex].dates,r=0;42>r;r+=1)dates[r].events=[];for(var i=0;i<eventSource.length;i+=1){var event=eventSource[i],eventDate=new Date(event.startTime);eventDate>=utcStartTime&&utcEndTime>=eventDate&&(dates[Math.floor((eventDate-utcStartTime)/864e5)].events=[event])}}function toogle(selectedTime){function getEventIndex(events,time){for(var j=-1,i=0;i<events.length;i++){var eventTime=events[i].startTime;if(eventTime.getDate()===time.getDate()&&eventTime.getMonth()===time.getMonth()&&eventTime.getFullYear()===time.getFullYear()){j=i;break}}return j}var eventSource=$scope.eventSource,event={startTime:selectedTime},index=getEventIndex(eventSource,selectedTime);index>-1?eventSource.splice(index,1):eventSource.push(event)}function registerSlideChanged(){$scope.currentViewIndex=0,$scope.slideChanged=function($index){$timeout(function(){var currentViewIndex=$scope.currentViewIndex,direction=0;currentViewIndex===$index-1||0===$index&&2===currentViewIndex?direction=1:(currentViewIndex===$index+1||2===$index&&0===currentViewIndex)&&(direction=-1),$scope.currentViewIndex=$index,vm.currentDate=getAdjacentCalendarDate(vm.currentDate,direction),refreshView(direction)},100)}}function getAdjacentCalendarDate(currentCalendarDate,direction){var firstDayInNextMonth,calculateCalendarDate=new Date(currentCalendarDate),year=calculateCalendarDate.getFullYear(),month=calculateCalendarDate.getMonth()+direction,date=calculateCalendarDate.getDate();return calculateCalendarDate.setFullYear(year,month,date),firstDayInNextMonth=new Date(year,month+1,1),firstDayInNextMonth.getTime()<=calculateCalendarDate.getTime()&&(calculateCalendarDate=new Date(firstDayInNextMonth-864e5)),calculateCalendarDate}function refreshView(direction){function getRange(currentDate){var endDate,firstDayOfMonth=new Date(currentDate.getFullYear(),currentDate.getMonth(),1),difference=vm.startingDayMonth-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,startDate=new Date(firstDayOfMonth);return numDisplayedFromPreviousMonth>0&&startDate.setDate(-numDisplayedFromPreviousMonth+1),endDate=new Date(startDate),endDate.setDate(endDate.getDate()+42),{startTime:startDate,endTime:endDate}}function refreshMonth(){var currentViewStartDate=vm.range.startTime,date=currentViewStartDate.getDate(),month=(currentViewStartDate.getMonth()+(1!==date?1:0))%12,year=currentViewStartDate.getFullYear()+(1!==date&&0===month?1:0),headerDate=new Date(year,month,1);$scope.monthTitle.lapin=dateFilter(headerDate,vm.formatMonthTitle)}function populateAdjacentViews(){function getDates(startDate){var dates=new Array(42),current=new Date(startDate);current.setHours(12);for(var i=0;i<dates.length;i++)dates[i]={date:new Date(current),event:!1},current.setDate(current.getDate()+1);return{dates:dates}}function getAdjacentViewStartTime(direction){var adjacentCalendarDate=getAdjacentCalendarDate(vm.currentDate,direction);return getRange(adjacentCalendarDate).startTime}var currentViewStartDate,currentViewData,toUpdateViewIndex,currentViewIndex=$scope.currentViewIndex;1===direction?(currentViewStartDate=getAdjacentViewStartTime(direction),toUpdateViewIndex=(currentViewIndex+1)%3,angular.copy(getDates(currentViewStartDate),$scope.views[toUpdateViewIndex])):-1===direction?(currentViewStartDate=getAdjacentViewStartTime(direction),toUpdateViewIndex=(currentViewIndex+2)%3,angular.copy(getDates(currentViewStartDate),$scope.views[toUpdateViewIndex])):$scope.views?(currentViewStartDate=vm.range.startTime,angular.copy(getDates(currentViewStartDate),$scope.views[currentViewIndex]),currentViewStartDate=getAdjacentViewStartTime(-1),toUpdateViewIndex=(currentViewIndex+2)%3,angular.copy(getDates(currentViewStartDate),$scope.views[toUpdateViewIndex]),currentViewStartDate=getAdjacentViewStartTime(1),toUpdateViewIndex=(currentViewIndex+1)%3,angular.copy(getDates(currentViewStartDate),$scope.views[toUpdateViewIndex])):(currentViewData=[],currentViewStartDate=vm.range.startTime,currentViewData.push(getDates(currentViewStartDate)),currentViewStartDate=getAdjacentViewStartTime(1),currentViewData.push(getDates(currentViewStartDate)),currentViewStartDate=getAdjacentViewStartTime(-1),currentViewData.push(getDates(currentViewStartDate)),$scope.views=currentViewData)}vm.range=getRange(vm.currentDate),refreshMonth(),populateAdjacentViews(),"local"===vm.queryMode?$scope.eventSource&&onDataLoaded&&onDataLoaded():"remote"===vm.queryMode&&$scope.rangeChanged&&$scope.rangeChanged({startTime:vm.range.startTime,endTime:vm.range.endTime})}var vm=this;$scope.$watch(function(){return $scope.eventSource},function(newVal,oldVal){onDataLoaded()},!0),init(),$scope.select=function(selectedTime){toogle(selectedTime),$scope.views&&$scope.timeSelected&&$scope.timeSelected({selectedTime:selectedTime})},registerSlideChanged(),refreshView()}var directive={};return directive.restrict="E",directive.replace=!0,directive.templateUrl="calendar.html",directive.scope={rangeChanged:"&",timeSelected:"&",titleChanged:"&",eventSource:"=",monthTitle:"="},directive.require=["calendar","?^ngModel"],directive.controllerAs="cc",directive.controller=CalendarController,CalendarController.$inject=["$scope","$attrs","$interpolate","calendarConfig","$timeout","dateFilter"],directive}angular.module("directives").directive("calendar",calendar),calendar.$inject=[]}(),function(){function sameMonth(){return function(date,currentDate){return date=new Date(+date),current=new Date(+currentDate),date.getMonth()===current.getMonth()}}angular.module("filters").filter("sameMonth",sameMonth),sameMonth.$inject=[]}(),function(){function todayFilter(){return function(date){date=new Date(+date);var today=new Date;return date.getDate()===today.getDate()&&date.getMonth()===today.getMonth()&&date.getFullYear()===today.getFullYear()}}angular.module("filters").filter("todayFilter",todayFilter),todayFilter.$inject=[]}(),function(){function weekNumber(){return function(date){date=new Date(+date),date.setHours(0,0,0,0),date.setDate(date.getDate()+3-(date.getDay()+6)%7);var week1=new Date(date.getFullYear(),0,4);return 1+Math.round(((date.getTime()-week1.getTime())/864e5-3+(week1.getDay()+6)%7)/7)}}angular.module("filters").filter("weekNumber",weekNumber),weekNumber.$inject=[]}(),function(){"use strict";angular.module("templates",[]).run(["$templateCache",function($templateCache){$templateCache.put("calendar.html",'<div style="height: 100%;">\n    <ion-slide-box  on-slide-changed="slideChanged($index)"\n                    does-continue="true"\n                    show-pager="false"\n                    delegate-handle="monthview-slide"\n                    style="height: auto;">\n        <ion-slide ng-repeat="view in views track by $index">\n            <table ng-if="$index===currentViewIndex" class="table-bordered monthview-datetable">\n                <thead>\n                    <tr>\n                        <th></th>\n                        <th ng-repeat="day in view.dates.slice(0,7) track by day.date">\n                            <small>{{::day.date | date: cc.formatDayHeader | uppercase}}</small>\n                        </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr ng-repeat="i in [0,1,2,3,4,5]">\n                        <td ng-click="">SEM<br>{{view.dates[7*i].date | weekNumber}}</td>\n                        <td ng-repeat="j in [0,1,2,3,4,5,6]"\n                            ng-init="date = view.dates[7*i+j]"\n                            ng-click="select(date.date)"\n                            ng-class="{\'monthview-secondary\': date.events.length > 0 && !(date.date | sameMonth : cc.currentDate), \'monthview-primary\': date.events.length > 0 && (date.date | sameMonth : cc.currentDate), \'monthview-current\': (date.date | todayFilter), \'text-muted\': !(date.date | sameMonth : cc.currentDate)}">{{date.date | date : cc.formatDay}}</td>\n                    </tr>\n                </tbody>\n            </table>\n            <table ng-if="$index!==currentViewIndex" class="table-bordered monthview-datetable">\n                <thead>\n                    <tr class="text-center">\n                        <th></th>\n                        <th ng-repeat="day in view.dates.slice(0,7) track by day.date">\n                            <small>{{::day.date | date: cc.formatDayHeader | uppercase}}</small>\n                        </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr ng-repeat="i in [0,1,2,3,4,5]">\n                        <td ng-click="">SEM<br>{{view.dates[7*i].date | weekNumber}}</td>\n                        <td ng-repeat="j in [0,1,2,3,4,5,6]"\n                            ng-init="date = view.dates[7*i+j]"\n'+"                            ng-class=\"{'monthview-secondary': date.events.length > 0 && !(date.date | sameMonth : cc.currentDate), 'monthview-primary': date.events.length > 0 && (date.date | sameMonth : cc.currentDate), 'monthview-current': (date.date | todayFilter), 'text-muted': !(date.date | sameMonth : cc.currentDate)}\">{{date.date | date : cc.formatDay}}</td>\n                    </tr>\n                </tbody>\n            </table>\n        </ion-slide>\n    </ion-slide-box>\n</div>\n")}])}();